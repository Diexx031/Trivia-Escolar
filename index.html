<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nexus Trivia</title>
  <style>
    /* --- IMPORTACIÓN DE FUENTE (Opcional pero recomendado) --- */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    /* --- ESTILOS GENERALES Y FONDO ANIMADO --- */
    body {
      font-family: 'Poppins', 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2, #ff8c00, #f6d365);
      background-size: 400% 400%;
      animation: gradientBG 20s ease infinite;
      text-align: center;
      padding: 20px;
      margin: 0;
      color: #333;
      overflow-x: hidden; /* Evita barras de scroll por animaciones */
    }

    /* Animación para el fondo */
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* --- TÍTULO PRINCIPAL --- */
    h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    h2 { font-size: 1.8rem; }
    h3 { font-size: 1.4rem; }

    /* --- ESTILO DE TARJETAS (Glassmorphism) --- */
    .ranking, .resultado, .pregunta, .inicio-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.18);
      margin: 20px auto;
      width: 90%;
      max-width: 600px;
      transition: box-shadow 0.3s ease; /* Transición para el foco */
    }
    
    /* --- NUEVO: ESTILO DE FOCO PARA EL TUTORIAL --- */
    .tutorial-focus {
      /* Borde pulsante y brillante para guiar al usuario */
      box-shadow: 0 0 25px 8px #ffd900, 0 8px 32px 0 rgba(0, 0, 0, 0.15);
      z-index: 10001; /* Asegura que esté sobre el overlay (10000) */
      position: relative; /* Necesario para z-index */
    }


    /* --- PANTALLA DE INICIO MEJORADA (Centrado y brillante) --- */
    #inicio {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 50vh;
    }
    .inicio-card h2 {
      margin-top: 0;
      color: #764ba2;
    }
    #nombreJugador {
      font-size: 1.1rem;
      padding: 12px 15px;
      border-radius: 10px;
      border: 2px solid #ddd;
      width: calc(100% - 34px);
      max-width: 300px;
      margin-bottom: 15px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    #nombreJugador:focus {
      border-color: #764ba2;
      box-shadow: 0 0 8px rgba(118, 75, 162, 0.3);
      outline: none;
    }
    #inicio button, #reiniciarBtn {
      font-size: 1.2rem;
      font-weight: 600;
      padding: 12px 30px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #764ba2, #667eea);
      color: white;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    #inicio button:hover, #reiniciarBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    #reiniciarBtn {
      margin-top: 20px;
    }

    /* --- ESTILO DE RESPUESTAS y Animaciones --- */
    .respuesta {
      display: block;
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 12px;
      padding: 15px;
      margin: 10px auto;
      max-width: 450px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      font-weight: 500;
    }
    .respuesta:hover:not(:disabled) {
      background: #f4f4f4;
      border-color: #764ba2;
      transform: scale(1.03);
    }
    .respuesta:disabled { cursor: not-allowed; opacity: 0.7; }
    .correcta {
      background: #c8e6c9 !important; border-color: #388e3c !important;
      animation: tada 0.8s ease; 
    }
    .incorrecta {
      background: #ffcdd2 !important; border-color: #d32f2f !important;
      animation: shake 0.5s ease; 
    }

    /* --- MARCA DE AGUA (diexx studios) --- */
    .diexx-studios-logo {
      position: fixed;
      bottom: 10px;
      right: 15px;
      font-size: 18px; 
      font-weight: bold;
      font-family: 'Consolas', 'Courier New', monospace;
      color: rgba(255, 255, 255, 0.6);
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
      z-index: 1000;
      opacity: 0;
      animation: fadeIn 1s forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }


    /* --- TEMPORIZADOR ANIMADO INMERSIVO --- */
    #timer-container {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      z-index: 100;
      overflow: hidden;
      animation: pulse 2s infinite ease-in-out;
    }
    #timer-barra {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to top, #f44336, #ff9800, #4caf50);
      background-size: 100% 1500%; 
      background-position-y: 100%; 
      z-index: 1;
      transition: background-position-y 1s linear; 
    }
    #timer-numero {
      font-size: 2rem;
      font-weight: 700;
      color: #333;
      position: relative;
      z-index: 2;
    }
    #timer-container.danger { animation: heartbeat 1s infinite; }
    

    /* --- RANKING REDISEÑADO con Animaciones y Medallas --- */
    #ranking-list {
      list-style-type: none; 
      padding-left: 0;
      font-size: 1.1rem;
      counter-reset: ranking; 
    }
    #ranking-list li {
      counter-increment: ranking; 
      padding: 10px 15px;
      margin-bottom: 8px; 
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #eee;
      display: flex;
      align-items: center;
      opacity: 0;
      transform: translateX(-50px);
      animation: slideIn 0.5s ease-out forwards;
    }
    #ranking-list li::before {
      content: counter(ranking); 
      font-weight: bold;
      font-size: 1.2rem;
      color: #764ba2;
      background: #f0f0f0;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      flex-shrink: 0;
    }
    #ranking-list li:first-child::before { background: #ffd700; color: white; }
    #ranking-list li:nth-child(2):::before { background: #c0c0c0; color: white; }
    #ranking-list li:nth-child(3):::before { background: #cd7f32; color: white; }
    @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }


    /* --- CONFETI --- */
    #confetti-canvas {
      position: fixed;
      pointer-events: none;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 999;
    }
    
    /* --- KEYFRAMES PARA ANIMACIONES --- */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      30% { transform: scale(1.15); }
      50% { transform: scale(1.05); }
      70% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }
    @keyframes tada {
      0% { transform: scale(1); }
      10%, 20% { transform: scale(0.9) rotate(-3deg); }
      30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
      40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
      100% { transform: scale(1) rotate(0); }
    }
    
    
    /*
    * ======================================
    * NUEVO: ESTILOS DE LA INTRO DE DIEXX
    * ======================================
    */
    
    #intro-diexx {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7); /* Fondo oscuro semitransparente */
      z-index: 10000;
      display: flex;
      justify-content: center;
      align-items: flex-end; /* Posiciona abajo */
      padding: 20px;
      box-sizing: border-box; /* Asegura que el padding no desborde */
      opacity: 1; /* Asegúrate de que sea visible al inicio */
      transition: opacity 0.5s ease; /* Transición para desvanecerse */
    }
    
    #avatar-container {
      position: absolute;
      bottom: 0;
      left: 20px; /* Posición inicial */
      width: 200px; /* Ajustado al ancho de tu imagen */
      height: 350px; /* Ajustado al alto de tu imagen */
      /* Animación de entrada */
      animation: slideInFromLeft 2s ease-out forwards;
    }
    
    @keyframes slideInFromLeft {
      from { transform: translateX(-200px); }
      to { transform: translateX(0); }
    }

/* --- AVATAR 2D (SOLUCIÓN CON ETIQUETA <img>) --- */
    #diexx-avatar-img {
      width: 100%; 
      height: 100%; 
      
      /* 'object-fit' es el equivalente de CSS a 'background-size: contain' */
      object-fit: contain; 
      
      /* 'object-position' es el equivalente a 'background-position' */
      object-position: bottom center;
    }

    /* Cuerpo y Cabeza (del antiguo avatar CSS) se eliminan/comentan aquí. */

    
    /* --- Globo de Texto (Speech Bubble) --- */
    #speech-bubble {
      position: relative;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      max-width: 400px;
      margin-left: 0.1px; /* Ajustado: espacio para el avatar (200px) + margen (30px) */
      margin-bottom: 50px;
      font-size: 1.2rem;
      color: #333;
      text-align: left;
      /* Animación de aparición */
      opacity: 0;
      animation: fadeIn 0.5s 1s forwards; /* Aparece después del avatar */
    }
    /* Triángulo del globo */
    #speech-bubble::before {
      content: '';
      position: absolute;
      bottom: 20px;
      left: -20px;
      width: 0;
      height: 0;
      border: 10px solid transparent;
      border-right-color: #fff;
      border-left: 0;
    }
    
    /* Cursor de escritura */
    #typing-cursor {
      display: inline-block;
      width: 10px;
      height: 1.2rem;
      background: #333;
      margin-left: 3px;
      animation: blink 0.7s infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }
    
  </style>
</head>
<body>
  
  <div class="diexx-studios-logo" id="logo-inicio">diexx studios</div>
  
  <div class="diexx-studios-logo" id="logo-final" style="display:none;">diexx studios</div>

  <div id="timer-container" style="display:none;">
    <div id="timer-barra"></div>
    <span id="timer-numero">15</span>
  </div>

  <audio id="tickSound" src="https://www.soundjay.com/clock/sounds/clock-ticking-2.mp3" loop preload="auto"></audio>
  <audio id="heartbeatSound" src="https://www.soundjay.com/human/heartbeat-01a.mp3" loop preload="auto"></audio>
  <audio id="typingSound" src="https://www.soundjay.com/communication/sounds/typewriter-key-1.mp3" preload="auto"></audio>


<div id="intro-diexx">
    <div id="avatar-container">
      <img id="diexx-avatar-img" src="avatar-diexx.png.png" Alt="Avatar de Diexx">
    </div>
    <div id="speech-bubble">
...
      <span id="intro-text"></span>
      <span id="typing-cursor"></span>
    </div>
  </div>


  <h1>Nexus Trivia</h1>

  <div class="ranking" id="ranking-container"> <h2>🏆 Ranking Top 10</h2>
    <ol id="ranking-list"></ol>
  </div>

  <div id="inicio">
    <div class="inicio-card" id="inicio-card-container"> <h2>¡Demuestra lo que sabes!</h2>
      <input type="text" id="nombreJugador" placeholder="Escribe tu nombre" minlength="3" maxlength="20">
      <button onclick="comenzarTrivia()">Empezar Trivia</button>
    </div>
  </div>

  <div class="pregunta" id="juego" style="display:none;"></div>
  
  <div class="resultado" id="resultadoFinal" style="display:none;"></div>
  
  <button id="reiniciarBtn" onclick="reiniciarJuego()" style="display:none;">Volver al inicio</button>
  
  <canvas id="confetti-canvas"></canvas>

 <script>
  // --- PREGUNTAS (Sin cambios) ---
  const preguntas = [
    {
      pregunta: "¿Quién es el Director/a del colegio?",
      opciones: ["Ramon Figueredo Troche", "Miguel Prieto", "Elena Nohemi Gonzalez"],
      correcta: "Ramon Figueredo Troche"
    },
    {
      pregunta: "¿Quién es el/la fundador/a de la escuela?",
      opciones: ["Doña Leopoldina Lopez", "Ramon Figueredo Troche", "Nohemí González"],
      correcta: "Doña Leopoldina Lopez"
    },
    {
      pregunta: "¿Qué docente enseña en quinto y sexto grado?",
      opciones: ["Delmia Sanchez", "Nohemi Gonzalez", "Aldo Peralta"],
      correcta: "Nohemi Gonzalez"
    },
    {
      pregunta: "¿Qué color es el uniforme de gala de la primaria?",
      opciones: ["camisa azul pantalon blanco", "camisa verde pantalon negro", "camisa rojo pantalon negro"],
      correcta: "camisa verde pantalon negro"
    },
    {
      pregunta: "¿Qué color es el uniforme de gala de la secundaria?",
      opciones: ["camisa blanca pantalon verde", "camisa roja pantalon negra", "camisa gris pantalon azul"],
      correcta: "camisa blanca pantalon verde"
    },
    {
      pregunta: "¿Cuál es la obra que Miguel Prieto anunció para el colegio?",
      opciones: ["nuevo Polideportivo", "pabellon completo de aulas", "sala de comedor y informática"],
      correcta: "pabellon completo de aulas"
    },
    {
      pregunta: "¿Qué lenguas enseñan en el colegio?",
      opciones: ["castellano guaraní", "castellano inglés guaraní", "castellano portugués"],
      correcta: "castellano inglés guaraní"
    },
    {
      pregunta: "En los inicios del colegio, ¿dónde se daban clases?",
      opciones: ["aulas premium", "casas de CONAVI", "debajo de un árbol"],
      correcta: "debajo de un árbol"
    },
    {
      pregunta: "¿Cuántos docentes enseñan en la primaria?",
      opciones: ["4 docentes", "5 docentes", "6 docentes"],
      correcta: "5 docentes"
    },
    {
      pregunta: "¿En qué año se fundó el colegio?",
      opciones: ["2001", "1999", "2000"],
      correcta: "2001"
    },
    {
      pregunta: "¿Cuánto es 7 x 8?",
      opciones: ["56", "64", "48"],
      correcta: "56"
    },
    {
      pregunta: "¿Quién descubrió América?",
      opciones: ["Cristóbal Colón", "Simón Bolívar", "Napoleón Bonaparte"],
      correcta: "Cristóbal Colón"
    },
    {
      pregunta: "¿Cuáles son los cinco estados de la materia?",
      opciones: ["Sólido, líquido, gaseoso, plasma y condensado de Bose-Einstein", "Sólido, líquido, gaseoso, fuego y aire", "Agua, hielo, vapor, tierra y plasma"],
      correcta: "Sólido, líquido, gaseoso, plasma y condensado de Bose-Einstein"
    },
    {
      pregunta: "¿Quién descubrió Paraguay?",
      opciones: ["Alejo Garcia", "Cristóbal Colón", "Francisco Pizarro"],
      correcta: "Alejo Garcia"
    },
    {
      pregunta: "¿Qué instrumento se usa para medir la temperatura?",
      opciones: ["Termómetro", "Barómetro", "Anemómetro"],
      correcta: "Termómetro"
    },
    {
      pregunta: "¿En qué año llegó Cristóbal Colón a América?",
      opciones: ["1492", "1500", "1600"],
      correcta: "1492"
    },
    {
      pregunta: "¿Qué órgano del cuerpo humano bombea la sangre?",
      opciones: ["Corazón", "Pulmón", "Hígado"],
      correcta: "Corazón"
    },
    {
      pregunta: "¿Cuál es el resultado de 12 x 6?",
      opciones: ["72", "66", "82"],
      correcta: "72"
    },
    {
      pregunta: "¿Cuál es el continente donde se encuentra Paraguay?",
      opciones: ["América del Sur", "Europa", "Asia"],
      correcta: "América del Sur"
    },
    {
      pregunta: "¿Con cuántos docentes cuenta la escuela y el colegio?",
      opciones: ["36", "37", "38"],
      correcta: "36"
    }
  ];

  // --- VARIABLES GLOBALES ---
  let jugador = "";
  let preguntaActual = 0;
  let puntuacion = 0;
  let tiempoTotal = 0;
  let tiempoInicio = 0;
  let temporizador;
  
  // Constantes para elementos del DOM
  const timerContainer = document.getElementById("timer-container");
  const timerNumero = document.getElementById("timer-numero");
  const timerBarra = document.getElementById("timer-barra");
  const logoInicio = document.getElementById("logo-inicio");
  const logoFinal = document.getElementById("logo-final");
  const nombreInput = document.getElementById("nombreJugador");
  const rankingContainer = document.getElementById("ranking-container"); // Foco
  const inicioContainer = document.getElementById("inicio");
  const inicioCardContainer = document.getElementById("inicio-card-container"); // Foco
  
  // Constantes para los sonidos
  const tickSound = document.getElementById("tickSound");
  const heartbeatSound = document.getElementById("heartbeatSound");
  const typingSound = document.getElementById("typingSound");

  // --- SIN CAMBIOS EN LA LÓGICA DE BARAJADO ---
  function barajarArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  /*
    FUNCIÓN DE CENSURA
  */
  function contieneInsulto(nombre) {
    const listaNegra = [
      "puto", "puta", "gey", "gay", "mierda", "pija", "culo", "gil", 
      "idiota", "bobo", "tonto", "pene", "vagina", "concha", "forro",
      "tarado", "pelotudo", "imbecil", "coger", "joder", "zorra", "maricon", 
      "cabron", "perra" 
    ];
    const leet = {'0': 'o', '1': 'i', '3': 'e', '4': 'a', '5': 's', '@': 'a', '$': 's'};
    let nombreNormalizado = nombre.toLowerCase().trim()
      .replace(/\s+/g, '') 
      .replace(/[01345@$]/g, m => leet[m]); 
    return listaNegra.some(insulto => nombreNormalizado.includes(insulto));
  }
  
  /*
    FUNCIÓN: Evita más de 3 repeticiones consecutivas (para spam)
  */
  function tieneRepeticionExcesiva(nombre) {
    return /(.)\1{3,}/i.test(nombre); 
  }


  // --- FUNCIÓN DE INICIO CON VALIDACIÓN COMPLETA ---
  function comenzarTrivia() {
    jugador = nombreInput.value.trim();
    
    // VALIDACIÓN 1: Mínimo (3) y Máximo (20) de letras
    if (jugador.length < 3) return alert("Tu nombre debe tener al menos 3 caracteres.");
    if (jugador.length > 20) return alert("Tu nombre no puede tener más de 20 caracteres.");
    // VALIDACIÓN 2: Repetición excesiva
    if (tieneRepeticionExcesiva(jugador)) return alert("Tu nombre no puede tener la misma letra o carácter repetido más de 3 veces consecutivas.");
    // VALIDACIÓN 3: Censura
    if (contieneInsulto(jugador)) return alert("El nombre ingresado no es apropiado. Por favor, elige uno diferente.");
    
    // Si pasa todas las validaciones
    inicioContainer.style.display = "none";
    rankingContainer.style.display = "none"; // Oculta el ranking al empezar
    document.getElementById("juego").style.display = "block";
    timerContainer.style.display = "flex";
    logoInicio.style.display = "none";
    
    preguntaActual = 0;
    puntuacion = 0;
    tiempoInicio = Date.now();
    barajarArray(preguntas);
    mostrarPregunta();
  }

  // --- SIN CAMBIOS EN LA LÓGICA ---
  function mostrarPregunta() {
    if (preguntaActual >= preguntas.length) return terminarTrivia();
    const contenedor = document.getElementById("juego");
    const p = preguntas[preguntaActual];
    const opcionesBarajadas = [...p.opciones].sort(() => Math.random() - 0.5);
    contenedor.innerHTML = `<h3>${p.pregunta}</h3>` + opcionesBarajadas.map(op =>
      `<button class='respuesta' onclick='responder(this, "${op}", "${p.correcta}")'>${op}</button>`).join("");
    
    iniciarTemporizadorAnimado();
  }

  // --- SIN CAMBIOS EN LA LÓGICA DE RESPUESTA ---
  function responder(btn, seleccionada, correcta) {
    detenerTemporizador(); 
    const botones = document.querySelectorAll(".respuesta");
    botones.forEach(b => {
      b.disabled = true;
      if (b.innerText === correcta) b.classList.add("correcta");
      else if (b.innerText === seleccionada) b.classList.add("incorrecta");
    });
    if (seleccionada === correcta) {
      puntuacion++;
      lanzarConfeti();
      new Audio("https://www.soundjay.com/human/applause-8.mp3").play();
    } else {
      new Audio("https://www.soundjay.com/button/beep-07.mp3").play();
    }
    setTimeout(() => {
      preguntaActual++;
      mostrarPregunta();
    }, 2000);
  }

  /*
    FUNCIÓN MODIFICADA: TEMPORIZADOR INMERSIVO Y SINCRONIZADO
  */
  function iniciarTemporizadorAnimado() {
    let tiempo = 15;
    
    timerNumero.innerText = tiempo;
    timerBarra.style.transition = 'none'; 
    timerBarra.style.backgroundPositionY = '100%';
    timerBarra.offsetHeight; 
    timerBarra.style.transition = 'background-position-y 1s linear';
    
    timerContainer.classList.remove('danger');
    timerContainer.style.animation = 'pulse 2s infinite ease-in-out';

    heartbeatSound.pause();
    heartbeatSound.currentTime = 0;
    tickSound.currentTime = 0; 
    tickSound.play();

    temporizador = setInterval(() => {
      tiempo--;
      timerNumero.innerText = tiempo;
      let porcentaje = (tiempo / 15) * 100;
      timerBarra.style.backgroundPositionY = porcentaje + '%';

      if (tiempo === 5) {
        timerContainer.classList.add('danger'); 
        tickSound.pause(); 
        heartbeatSound.play();
      }

      if (tiempo <= 0) {
        clearInterval(temporizador);
        tickSound.pause();
        heartbeatSound.pause();
        responder({innerText:""}, "", preguntas[preguntaActual].correcta);
      }
    }, 1000);
  }

  // --- DETENER EL TEMPORIZADOR Y SONIDOS ---
  function detenerTemporizador() {
    clearInterval(temporizador);
    timerContainer.style.animation = 'none'; 
    tickSound.pause();
    heartbeatSound.pause();
  }

  // --- FUNCIÓN MODIFICADA ---
  function terminarTrivia() {
    detenerTemporizador();
    
    tiempoTotal = Math.floor((Date.now() - tiempoInicio) / 1000);
    const resultado = document.getElementById("resultadoFinal");
    resultado.style.display = "block";
    resultado.innerHTML = `<h3>${puntuacion >= preguntas.length / 2 ? "¡Felicidades, " + jugador + "!" : "Más suerte la próxima, " + jugador}</h3><h2>Has acertado ${puntuacion}/${preguntas.length} en ${tiempoTotal} segundos.</h2>`;

    actualizarRanking();
    document.getElementById("reiniciarBtn").style.display = "inline-block";
    document.getElementById("juego").style.display = "none";
    rankingContainer.style.display = "block"; // Vuelve a mostrar el ranking
    
    timerContainer.style.display = "none";
    logoFinal.style.display = "block";
  }

  // --- SIN CAMBIOS EN LA LÓGICA ---
  function reiniciarJuego() {
    location.reload();
  }

  // --- SIN CAMBIOS EN LA LÓGICA ---
  function actualizarRanking() {
    const ranking = JSON.parse(localStorage.getItem("rankingTrivia") || "[]");
    ranking.push({ nombre: jugador, puntaje: puntuacion, tiempo: tiempoTotal });
    ranking.sort((a, b) => b.puntaje - a.puntaje || a.tiempo - b.tiempo);
    const top10 = ranking.slice(0, 10);
    localStorage.setItem("rankingTrivia", JSON.stringify(top10));
    mostrarRanking();
  }

  /*
    FUNCIÓN MODIFICADA: RANKING CON ANIMACIONES Y MEDALLAS
  */
  function mostrarRanking() {
    const lista = document.getElementById("ranking-list");
    const ranking = JSON.parse(localStorage.getItem("rankingTrivia") || "[]");
    
    lista.innerHTML = ranking.map((r, i) => {
        let emoji = "";
        if (i === 0) emoji = "🥇";
        else if (i === 1) emoji = "🥈";
        else if (i === 2) emoji = "🥉";
        
        return `<li style="animation-delay: ${i * 0.1}s">
                  ${r.nombre} ${emoji} - ${r.puntaje}/${preguntas.length} - ${r.tiempo}s
                </li>`;
      }).join("");

    if (ranking.length === 0) {
      lista.innerHTML = "<li>Aún no hay puntajes. ¡Sé el primero!</li>";
    }
  }

  // --- SIN CAMBIOS EN LA LÓGICA DE CONFETI ---
  function lanzarConfeti() {
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let piezas = Array.from({length: 150}, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      r: Math.random() * 6 + 4,
      d: Math.random() * 10 + 10,
      color: `hsl(${Math.random() * 360}, 100%, 50%)`,
      tilt: Math.random() * 10 - 10
    }));
    let anim = setInterval(() => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      piezas.forEach(p => {
        ctx.beginPath();
        ctx.fillStyle = p.color;
        ctx.ellipse(p.x, p.y, p.r, p.r / 2, p.tilt, 0, Math.PI * 2);
        ctx.fill();
        p.y += p.d / 5;
        p.tilt += 0.1;
        if (p.y > canvas.height) p.y = -20;
      });
    }, 16);
    setTimeout(() => { clearInterval(anim); ctx.clearRect(0, 0, canvas.width, canvas.height); }, 2000);
  }
  
  
  
  /*
  * ======================================
  * NUEVO: LÓGICA DE LA INTRO DE DIEXX
  * ======================================
  */
  
  const introContainer = document.getElementById("intro-diexx");
  const introTextEl = document.getElementById("intro-text");
  const typingCursorEl = document.getElementById("typing-cursor");

  // Función para simular escritura letra por letra
  function mostrarTextoAnimado(texto, callback) {
    let i = 0;
    introTextEl.innerHTML = ""; // Limpia el texto anterior
    typingCursorEl.style.display = 'inline-block'; // Muestra el cursor
    
    const intervalo = setInterval(() => {
      if (i < texto.length) {
        introTextEl.innerHTML += texto.charAt(i);
        typingSound.currentTime = 0; // Reinicia el sonido
        typingSound.play();
        i++;
      } else {
        clearInterval(intervalo);
        typingCursorEl.style.display = 'none'; // Oculta el cursor al final
        if (callback) setTimeout(callback, 500); // Llama al siguiente paso
      }
    }, 70); // Velocidad de escritura (milisegundos)
  }
  
  // Secuencia del tutorial
  function iniciarIntroDiexx() {
    // 1. Saludo
    mostrarTextoAnimado("¡Hola! Soy Diexx, el creador de Nexus...", () => {
      // 2. Pedir click
      mostrarTextoAnimado("Haz click en cualquier parte para continuar...", () => {
        // Habilita el click en toda la intro
        introContainer.style.cursor = "pointer";
        introContainer.onclick = () => {
          introContainer.style.cursor = "default";
          introContainer.onclick = null; // Deshabilita click
          
          // 3. Tutorial del Nombre
          mostrarTextoAnimado("Para empezar, debes poner tu nombre aquí.", () => {
            // Enfoca la tarjeta de inicio
            inicioCardContainer.classList.add("tutorial-focus");
            
            setTimeout(() => {
              // 4. Tutorial del Ranking
              inicioCardContainer.classList.remove("tutorial-focus");
              mostrarTextoAnimado("Dependiendo de qué tan bueno seas, tu nombre aparecerá aquí.", () => {
                // Enfoca el ranking
                rankingContainer.classList.add("tutorial-focus");
                
                setTimeout(() => {
                  // 5. Despedida y cierre
                  rankingContainer.classList.remove("tutorial-focus");
                  mostrarTextoAnimado("¡Mucha suerte!", () => {
                    // Cierra la intro
                    introContainer.style.opacity = 0;
                    setTimeout(() => {
                      introContainer.style.display = "none";
                      // El inicio y ranking ya están visibles.
                    }, 500);
                  });
                }, 2500); // Tiempo de foco en ranking
              });
            }, 2500); // Tiempo de foco en nombre
          });
        };
      });
    });
  }


  // --- INICIALIZACIÓN (CORREGIDO) ---
  // Muestra el ranking (se llenará)
  mostrarRanking();
  
  // Inicia la intro de Diexx
  iniciarIntroDiexx();
  
</script>

</body>
</html>
